為什麼我無法收到收集事件消息?
主機無法收到收集事件消息的可能原因有幾個。
1.	主機和設備必須使用成功的S1F13/S1F14交換建立GEM通信。
2.	GEM控制狀態必須線上。它不能處於主機-離線或設備-離線狀態。
3.	GEM Spooling 必須是非活躍的。在Spooling已經活躍時時禁用該功能並不會使Spooling變為活躍。如果不需要Spooling消息，則需要使用消息S6F23清除Spooling內容。如果需要周邊同作消息，那麼使用S6F23逐個獲取它們，直到Spooling機狀態變為非活躍狀態。
4.	必須啟用收集事件。使用S1F3檢查“EventsEnabled”狀態變數以確認收集事件已啟用。使用消息S2F37啟用收集事件。
5.	需要發生收集事件活動。例如，如果材料沒有實際到達，那麼當材料到達時將永遠不會發生收集事件報告。如果活動發生且滿足上述條件，則設備GEM介面存在缺陷。
如果設備的GEM介面沒有發佈我需要的收集事件，該怎麼辦?
請設備供應商添加所需的收集事件。設備供應商很難準確預測工廠需要的所有收集事件。設備供應商需要升級其在工廠中的GEM介面軟體。
當連結到收集事件時，資料包告的大小是多少?
GEM允許單個資料變數值或狀態變數的值為任意資料類型的陣列或結構體，包括浮點數、字串或整數。單個陣列的大小限制為16.777215 MB，消息的總大小限制為4.294967295 GB。
 
# 第三章 資料輪詢
GEM是一種工業標準，它定義了工藝設備和工廠主機軟體之間， 為了達到監視和控制目的所建立通信的標準方法。

通過連接GEM設備，工廠可以立即體驗到運營效益。工廠主機可以通過多種方式收集資料。

之前的一篇博客文章討論了使用收集事件報告收集資料，其中資料基於設備狀態的變化被推送到主機。

除了事件報告之外，工廠主機通常還需要輪詢設備的當前資料值。資料值可以由主機直接請求，也可以在跟蹤報告中定期採樣。

這就是所謂的資料輪詢，也是今天討論的主題。
## 資料的類型
* GEM介面中有三種類型的資料:
  * 資料變數(DV) —— 設備事件發生時可以收集的資料項目。此資料只保證在事件上下文中有效。例如，GEM介面可能提供一個名為PPChanged的事件(當配方發生更改時觸發)。該介面還可以提供一個名為changed recipe的資料變數。此資料變數（DV）的值僅在PPChanged事件的上下文中有效。在其他的時間輪詢該值可能會有無效或意外的資料。
  
  * 狀態變數(SV) —— 包含設備資訊的資料項目。該資料保證在任何時候都是有效的。例如，該設備可能在流程模組中有一個溫度感測器。GEM介面可以提供模組溫度狀態變數。主機可以在任何時候請求這個狀態變數(SV)的值，並期望這個值是準確的。
  
  * 設備常數(EC) —— 包含設備設置的資料項目。設備常數決定設備的行為。例如，GEM介面可能有一個名為MaxSimultaneousTraces的設備常量（EC），該常量指定可以同時從主機請求的最大跟蹤數。設備常數的值總是保證是有效的和最新的。

## 資料屬性
上面列出的三種資料類型都有一些類似的有助於定義資料的屬性。設備供應商需要在GEM手冊中提供這些屬性，以便工廠主機能夠與資料進行交互。一些重要的資料屬性有:
* ID —— 在該GEM介面中唯一的數位ID。這些ID可以按資料類型分為 **SVID ( 狀態變數 ID )**, **DVID ( 資料變數ID )** 和 **ECID ( 設備常量ID )**。
* 名稱 —— 資料項目的可讀名稱。
* 格式 —— 資料項目的資料類型。
   資料格式可以是簡單類型(數位、ASCII、布林值)，也可以是複雜類型(陣列、清單、結構)。

  例如，數位類型可以是  
  I1、I2、I4、I8(不同位元組長度的帶符號整數類型)  
  U1、U2、U4、U8(不帶正負號的整數類型)和F4或F8(浮點類型)。  
  清單和陣列類型會在資料項目中包含多個值。例如，圖像資料通常採用位元組陣列作為資料格式。  
  結構類型包含特定類型的資料。例如，一個變數可以表示一個Slot map,其中包含Carrier資訊，Slot清單和晶圓的存放資訊。  

* 值 —— 資料項目的實際值。
  資料值採用精確、高效、自描述的二進位格式，從而主機知道如何解釋資料。資料格式允許更有效地收集更多的資料。  
  收集事件(CE)和警報也有ID和名稱。這些內容將在其他博客文章中討論，但是瞭解本文的提到的這些屬性非常重要，因為這些屬性也可以被Host所查詢。
### 數據輪詢
如前所述，工廠主機經常通過它所定義的跟蹤報告和事件報告定期獲得資料。GEM還為工廠主機提供了一種可以根據他的需要去輪詢設備資料的方法。
### 狀態變數
  主機可以在任何時候通過發送一條包含狀態變數ID（SVID）清單的消息來查詢這些狀態變數(SV)的當前值。  
  如果該列表的長度為1，則只返回單個狀態變數(SV)的值。如果清單的長度為零，則返回GEM介面中定義的所有狀態變數(SV)的值。  
  這些值會包含在在設備回復的S1F4消息中。
  
  主機還可以通過向設備發送S1F11消息向設備請求狀態變數（SV）名稱清單。  
  上面提到的清單規則也適用於此消息。返回消息將包含每個狀態變數(SV)的條目，包括狀態變數ID（SVID）、名稱和單位。  
### 設備常量
狀態變數(SV)的工作方式類似，主機還可以通過發送一條S2F13消息來查詢GEM介面中定義的設備常量的值。這些值會包含在在設備回復的S2F14消息中。
與狀態變數(SV)類似，可以使用S2F29消息查詢設備常量的名稱清單。
### 資料變數
由於資料變數只在集合事件的上下文中有效，因此沒有輪詢資料變數值的方法。資料變數的值只能在收集事件報告中上報給主機。
###其他
除了上面討論的資料輪詢方法外，還可以通過輪詢從設備獲取以下資訊:
* 收集事件(CE) —— 主機可以查詢GEM介面上可用的收集事件，以及與每個CE關聯的DVs。這些是使用S1F23消息請求的。
* 警報 —— 主機可以通過發送一個列有所期望的警報ID列表的S5F5消息來查詢設備上有哪些警報是可用的。  
  返回的消息將列出與ALID關聯的警報ID和警報文本。每個GEM介面都需要有兩個狀態變數。AlarmEnabled包含設備上所有啟用警報的ID列表。  
  AlarmsSet包含設備商所有當前處於設置狀態的警報ID。由於這些值是狀態變數，所以主機可以在任何時候查詢它們的值。  
  MDLN和SOFTREV —— 對S1F1(你在嗎?)消息的回復將包含設備模型類型(MDLN)和軟體修訂版本(SOFTREV)。  
* DateTime ——主機可以使用S2F17消息請求設備的日期和時間，也可以使用S2F31消息同步設備的時間。
  GEM要求設備維護一個包含當前時間的時鐘狀態變數。允許主機查詢和同步時間使得可以對系統上幾乎同時發生的事件進行排序。  
### 跟蹤資料收集
跟蹤資料收集提供了一種定期採樣資料的方法。這種基於時間的資料收集方法對於跟蹤一段時間內的資料變化趨勢或重複的應用，或者監視連續的資料非常有用。 在創建跟蹤的定義時，主機需要提供以下內容:
* 採樣週期 —— 樣本之間的時間。以百分之一秒為最小單位，因此可以使用跟蹤非常快速地收集資料。能夠支援10赫茲的採樣間隔資料的設備很常見。
* 資料組大小 —— 跟蹤報告中包含的樣本數量。
* 狀態變數 —— 跟蹤報告中包含的狀態變數清單。
* 總樣本數 —— 在跟蹤的整個生命週期內要採集的樣本數量。
* 跟蹤請求ID —— 跟蹤請求的識別字(GEM只允許整數類型的跟蹤ID)。
  主機使用S2F23消息定義跟蹤請求。跟蹤報告使用S6F1消息從設備發送到主機。  
### 跟蹤報告樣本
* 假設一個設備正在處理一個晶圓片，這個過程需要5分鐘。重要的是要保持卡盤溫度在一定的可接受範圍內，並確保腔室壓力保持在指定的水準以下。
  每隔15秒採樣一次這些狀態變數值就足夠了，但是我們可以創建資料組，實現每分鐘只接收一次報告。  
主機可以發送一條包含如下跟蹤配置的S2F23消息:
* 跟蹤ID : 100 (ID必須是整數)
*採樣週期 : 00001500(每15秒採樣一次)
*總樣本:75個(每15秒採樣5英寸)
*數據組大小: 4
*SVID列表 :
 * 300(包含卡盤溫度資訊的狀態變數的ID)
 * 301(包含室壓資訊的狀態變數ID)
一分鐘後，第一個跟蹤報告將來自設備發出的的S6F1消息。這條消息將包含以下資訊:

`跟蹤ID` | `最後一個樣本號` | `日期格式取決於時間格式設備常數` 
:---:|:---:|:---:
100 | 4 |2018-01-22T14:20:34.8

`狀態變數清單:`|(長度為8 : 2 個狀態變數，資料組大小為4)
219.96(第一次採樣卡盤溫度)
0.0112(第一次採樣壓力)
219.97(第二次採樣卡盤溫度)
0.0122(第二次採樣壓力)
219.97(第三次採樣卡盤溫度)
0.0120(第三次採樣壓力)
219.96(第四次採樣卡盤溫度)
0.0119(第四次採樣壓力)
再過一分鐘，跟蹤報告可能如下所示:
100(跟蹤ID)
8(最後一個樣本號)
2018-01-22T14:21:34.8(日期時間顯示比第一個跟蹤晚一分鐘)
狀態變數清單 : (長度為8: 2 個狀態，資料組大小為4)
219.96(第五次採樣卡盤溫度)
0.0112(第五次採樣壓力)
219.97(第六次採樣卡盤溫度)
0.0122(第六次採樣壓力)
220.01(第七次採樣卡盤溫度)
0.0120(第七次採樣壓力)
220.00(第八次採樣卡盤溫度)
0.0119(第八次採樣壓力)
以一分鐘為間隔，後續還將收到三份報告。主機可以檢查報告中返回的值，並在值超出預期範圍時做出相應的處理。
結論
如果主機想在特定的時間點檢查一個值，它可以使用S1F3輪詢狀態資料。如果希望在給定的時間內連續收集資料，則可以設置跟蹤報告。
使用本博客中概述的資料採樣方法，將允許主機應用程式在需要時輪詢所需的資料。GEM提供了從設備請求資料的靈活性，允許主機在給定的時間點查詢值，或者使用跟蹤定期採樣樣。



[資料來源](https://www.cimetrix.com/tw/secs-gem-features-and-benefits-blog)
